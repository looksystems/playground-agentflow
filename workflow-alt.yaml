description: Determines if a communication qualifies as a personal recommendation
  based on recipient capacity, investment actions, personalization, and distribution
  scope
raw_text: 'A personal recommendation means a recommendation that:


  (1) is made to a person in their capacity as:

  (a) an investor or potential investor; or

  (b) agent for an investor or a potential investor;

  (2) is for the person in (1) to do any of the following (whether as principal or
  agent):

  (a) buy, sell, subscribe for, exchange, redeem, hold or underwrite a particular
  investment which is a security, a structured deposit or a relevant investment; or

  (b) exercise or not exercise any right conferred by such an investment to buy, sell,
  subscribe for, exchange or redeem such an investment;

  (3) is:

  (a) presented as suitable for the person to whom it is made; or

  (b) based on a consideration of the circumstances of that person; and

  (4) is not issued exclusively to the public.'
title: Personal Recommendation Classification Policy
workflow:
  nodes:
  - id: preprocess_input
    params:
      transforms:
      - normalize_whitespace
      - strip_html
      - truncate:10000
    routes:
      default: extract_key_info
    type: TransformNode
  - id: extract_key_info
    params:
      schema:
        entities:
          actions: list of investment actions mentioned (buy, sell, hold, etc.)
          investments: list of specific investments or securities mentioned
          recipients: list of who the communication is addressed to
        facts:
        - is this addressed to investors or potential investors
        - does it recommend specific investment actions
        - is it presented as suitable for specific recipients
        - is it based on individual circumstances
        - is it publicly distributed
        values:
          distribution_scope: how widely is this distributed
          personalization_level: how personalized is the content
    routes:
      default: check_recipient_capacity
    type: DataExtractorNode
  - id: check_recipient_capacity
    params:
      categories:
      - investor_capacity
      - agent_capacity
      - other_capacity
      descriptions:
        agent_capacity: Communication is made to someone acting as an agent for an
          investor or potential investor
        investor_capacity: Communication is made to someone in their capacity as an
          investor or potential investor
        other_capacity: Communication is made to someone in a different capacity (employee,
          general public, etc.)
    routes:
      agent_capacity: check_investment_actions
      investor_capacity: check_investment_actions
      other_capacity: not_personal_recommendation
    type: ClassifierNode
  - id: check_investment_actions
    params:
      mode: any
      patterns:
      - \b(buy|sell|subscribe|exchange|redeem|hold|underwrite)\b
      - \b(exercise|not exercise)\b.*\b(right|option)\b
      - \b(purchase|acquire|dispose|invest)\b
    routes:
      matched: check_personalization
      not_matched: not_personal_recommendation
    type: PatternMatchNode
  - id: check_personalization
    params:
      aggregation: majority
      inner_prompt: 'Analyze if this communication is personalized by checking if
        it is either:

        1. Presented as suitable for the specific person/recipient, OR

        2. Based on consideration of that person''s individual circumstances


        Look for indicators like:

        - Direct addressing ("for you", "suitable for your situation")

        - References to personal circumstances, risk profile, or needs

        - Customized recommendations based on individual factors

        - Tailored advice rather than general information


        Answer with result: true if personalized, false if generic/general

        '
      n_samples: 3
    routes:
      consensus: check_distribution_scope
      majority: check_distribution_scope
      split: needs_human_review
    type: SamplerNode
  - id: check_distribution_scope
    params:
      categories:
      - public_distribution
      - private_distribution
      - unclear_distribution
      descriptions:
        private_distribution: Communication is sent to specific individuals or limited
          groups
        public_distribution: Communication is issued exclusively to the general public
          (websites, public advertisements, mass media)
        unclear_distribution: Distribution scope is ambiguous or cannot be determined
    routes:
      private_distribution: is_personal_recommendation
      public_distribution: not_personal_recommendation
      unclear_distribution: needs_human_review
    type: ClassifierNode
  - id: is_personal_recommendation
    params:
      schema:
        facts:
        - classification result: personal recommendation
        - reason: meets all four criteria of the policy
    routes: {}
    type: DataExtractorNode
  - id: not_personal_recommendation
    params:
      schema:
        facts:
        - classification result: not a personal recommendation
        - reason: fails to meet one or more policy criteria
    routes: {}
    type: DataExtractorNode
  - id: needs_human_review
    params:
      schema:
        facts:
        - classification result: requires human review
        - reason: ambiguous content that cannot be automatically classified
    routes: {}
    type: DataExtractorNode
  start_node: preprocess_input
